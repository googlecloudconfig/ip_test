<!DOCTYPE html>
<html lang="fr">
<head><meta charset="UTF-8"><title>Détecter IP avec WebRTC</title></head>
<body>
  <h1>IPs détectées par WebRTC</h1>
  <pre id="ips">Recherche en cours...</pre>

  <script>
    function getIPs(callback) {
      const ips = new Set();
      const pc = new RTCPeerConnection({iceServers: []});
      pc.createDataChannel(""); // Nécessaire pour déclencher la découverte ICE

      pc.onicecandidate = event => {
        if (!event.candidate) {
          pc.close();
          callback(Array.from(ips));
          return;
        }
        const ipRegex = /([0-9]{1,3}(\.[0-9]{1,3}){3})/;
        const ipMatch = ipRegex.exec(event.candidate.candidate);
        if (ipMatch) {
          ips.add(ipMatch[1]);
        }
      };

      pc.createOffer()
        .then(offer => pc.setLocalDescription(offer))
        .catch(err => console.error(err));
    }

    getIPs(ips => {
      if (ips.length === 0) {
        document.getElementById('ips').textContent = "Aucune IP détectée (WebRTC bloqué ou non supporté)";
      } else {
        document.getElementById('ips').textContent = ips.join('\n');
      }
    });
  </script>
</body>
</html>
